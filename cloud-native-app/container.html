<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Container | HTDP1</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="htdp1 github pages">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/am-arch/assets/css/0.styles.cf1d3b34.css" as="style"><link rel="preload" href="/am-arch/assets/js/app.89e1056e.js" as="script"><link rel="preload" href="/am-arch/assets/js/2.158b03bb.js" as="script"><link rel="preload" href="/am-arch/assets/js/22.b2655bc9.js" as="script"><link rel="preload" href="/am-arch/assets/js/30.495713a6.js" as="script"><link rel="prefetch" href="/am-arch/assets/js/10.f985dceb.js"><link rel="prefetch" href="/am-arch/assets/js/11.13a0885b.js"><link rel="prefetch" href="/am-arch/assets/js/12.784f5764.js"><link rel="prefetch" href="/am-arch/assets/js/13.0705463a.js"><link rel="prefetch" href="/am-arch/assets/js/14.edf1e9bf.js"><link rel="prefetch" href="/am-arch/assets/js/15.ecbe92b4.js"><link rel="prefetch" href="/am-arch/assets/js/16.b0e5273b.js"><link rel="prefetch" href="/am-arch/assets/js/17.c1412e8f.js"><link rel="prefetch" href="/am-arch/assets/js/18.2bf38a43.js"><link rel="prefetch" href="/am-arch/assets/js/19.d66be9cb.js"><link rel="prefetch" href="/am-arch/assets/js/20.2d12a517.js"><link rel="prefetch" href="/am-arch/assets/js/21.4a5538a4.js"><link rel="prefetch" href="/am-arch/assets/js/23.f69f4766.js"><link rel="prefetch" href="/am-arch/assets/js/24.d9cb860d.js"><link rel="prefetch" href="/am-arch/assets/js/25.7a3200a9.js"><link rel="prefetch" href="/am-arch/assets/js/26.5cb3a254.js"><link rel="prefetch" href="/am-arch/assets/js/27.0c63f9e7.js"><link rel="prefetch" href="/am-arch/assets/js/28.58281d66.js"><link rel="prefetch" href="/am-arch/assets/js/29.164199d9.js"><link rel="prefetch" href="/am-arch/assets/js/3.0b98036c.js"><link rel="prefetch" href="/am-arch/assets/js/31.4507fc8d.js"><link rel="prefetch" href="/am-arch/assets/js/32.e2d5f511.js"><link rel="prefetch" href="/am-arch/assets/js/33.5a7d28a0.js"><link rel="prefetch" href="/am-arch/assets/js/34.24927452.js"><link rel="prefetch" href="/am-arch/assets/js/35.b946ec72.js"><link rel="prefetch" href="/am-arch/assets/js/36.3e0df84b.js"><link rel="prefetch" href="/am-arch/assets/js/37.baf5ac72.js"><link rel="prefetch" href="/am-arch/assets/js/38.924d0d58.js"><link rel="prefetch" href="/am-arch/assets/js/39.c9ada2db.js"><link rel="prefetch" href="/am-arch/assets/js/4.3bf6929e.js"><link rel="prefetch" href="/am-arch/assets/js/40.59ff4950.js"><link rel="prefetch" href="/am-arch/assets/js/41.e36e5e29.js"><link rel="prefetch" href="/am-arch/assets/js/42.8fbd702b.js"><link rel="prefetch" href="/am-arch/assets/js/43.682ed0be.js"><link rel="prefetch" href="/am-arch/assets/js/44.e96bd250.js"><link rel="prefetch" href="/am-arch/assets/js/45.e5548ca0.js"><link rel="prefetch" href="/am-arch/assets/js/46.eb3135d2.js"><link rel="prefetch" href="/am-arch/assets/js/47.75bfb6d8.js"><link rel="prefetch" href="/am-arch/assets/js/48.24475551.js"><link rel="prefetch" href="/am-arch/assets/js/49.4f9d97da.js"><link rel="prefetch" href="/am-arch/assets/js/5.612537aa.js"><link rel="prefetch" href="/am-arch/assets/js/50.9396ae6a.js"><link rel="prefetch" href="/am-arch/assets/js/51.0246b6e3.js"><link rel="prefetch" href="/am-arch/assets/js/52.b63d5ce3.js"><link rel="prefetch" href="/am-arch/assets/js/53.1f0c3f8c.js"><link rel="prefetch" href="/am-arch/assets/js/54.945e81a6.js"><link rel="prefetch" href="/am-arch/assets/js/55.7f8cfc43.js"><link rel="prefetch" href="/am-arch/assets/js/56.c5892f1b.js"><link rel="prefetch" href="/am-arch/assets/js/57.95dda11c.js"><link rel="prefetch" href="/am-arch/assets/js/58.5239fcca.js"><link rel="prefetch" href="/am-arch/assets/js/59.8c2edf4b.js"><link rel="prefetch" href="/am-arch/assets/js/6.744bf98a.js"><link rel="prefetch" href="/am-arch/assets/js/60.41a76796.js"><link rel="prefetch" href="/am-arch/assets/js/61.26101a83.js"><link rel="prefetch" href="/am-arch/assets/js/62.f17e7ccd.js"><link rel="prefetch" href="/am-arch/assets/js/63.26013c6d.js"><link rel="prefetch" href="/am-arch/assets/js/64.5a311c5f.js"><link rel="prefetch" href="/am-arch/assets/js/65.eb28022b.js"><link rel="prefetch" href="/am-arch/assets/js/7.fed2825e.js"><link rel="prefetch" href="/am-arch/assets/js/8.8c182984.js"><link rel="prefetch" href="/am-arch/assets/js/9.3fd7e149.js">
    <link rel="stylesheet" href="/am-arch/assets/css/0.styles.cf1d3b34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/am-arch/" class="home-link router-link-active"><!----> <span class="site-name">HTDP1</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/am-arch/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/am-arch/cloud/" class="nav-link">
  Cloud
</a></div><div class="nav-item"><a href="/am-arch/refarch/" class="nav-link">
  Ref. Arch.
</a></div><div class="nav-item"><a href="/am-arch/cloud-native-app/" class="nav-link router-link-active">
  Cloud.Native.App
</a></div><div class="nav-item"><a href="/am-arch/machinelearning/" class="nav-link">
  M / L
</a></div><div class="nav-item"><a href="/am-arch/gitops/" class="nav-link">
  GitOps
</a></div><div class="nav-item"><a href="/am-arch/multi-cloud/" class="nav-link">
  Multi Cloud
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/am-arch/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/am-arch/cloud/" class="nav-link">
  Cloud
</a></div><div class="nav-item"><a href="/am-arch/refarch/" class="nav-link">
  Ref. Arch.
</a></div><div class="nav-item"><a href="/am-arch/cloud-native-app/" class="nav-link router-link-active">
  Cloud.Native.App
</a></div><div class="nav-item"><a href="/am-arch/machinelearning/" class="nav-link">
  M / L
</a></div><div class="nav-item"><a href="/am-arch/gitops/" class="nav-link">
  GitOps
</a></div><div class="nav-item"><a href="/am-arch/multi-cloud/" class="nav-link">
  Multi Cloud
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Cloud Native App</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/am-arch/cloud-native-app/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/am-arch/cloud-native-app/container.html" aria-current="page" class="active sidebar-link">Container</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/am-arch/cloud-native-app/container.html#주요-특징" class="sidebar-link">주요 특징</a></li><li class="sidebar-sub-header"><a href="/am-arch/cloud-native-app/container.html#주요-기술" class="sidebar-link">주요 기술</a></li><li class="sidebar-sub-header"><a href="/am-arch/cloud-native-app/container.html#container-build" class="sidebar-link">Container Build</a></li></ul></li><li><a href="/am-arch/cloud-native-app/k8s.html" class="sidebar-link">Kubernetes</a></li><li><a href="/am-arch/cloud-native-app/restapi.html" class="sidebar-link">Restful API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Springboot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/am-arch/cloud-native-app/springboot/" class="sidebar-link">Overview</a></li><li><a href="/am-arch/cloud-native-app/springboot/restapi.html" class="sidebar-link">Restful API</a></li><li><a href="/am-arch/cloud-native-app/springboot/bean.html" class="sidebar-link">Bean</a></li><li><a href="/am-arch/cloud-native-app/springboot/env.html" class="sidebar-link">App. 환경설정</a></li><li><a href="/am-arch/cloud-native-app/springboot/mybatis.html" class="sidebar-link">Mybatis</a></li><li><a href="/am-arch/cloud-native-app/springboot/rest-client.html" class="sidebar-link">Restful API Client</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="container"><a href="#container" class="header-anchor">#</a> Container</h1> <div class="custom-block danger"><p class="custom-block-title">정의</p> <p>컨테이너는 소프트웨어 서비스를 실행하는 데 필요한 특정 버전의 프로그래밍 언어 런타임 및 라이브러리와 같은 종속 항목과 애플리케이션 코드를 함께 포함하는 경량 패키지입니다.</p></div> <p><img src="/am-arch/assets/img/2021-08-05-22-09-20.a10c8766.png" alt="image"></p> <p>컨테이너는 어떤 환경에서나 실행하기 위해 필요한 모든 요소를 포함하는 소프트웨어 패키지입니다. 컨테이너는 이러한 방식으로 운영체제를 가상화하며 프라이빗 데이터 센터에서 퍼블릭 클라우드 또는 개발자의 개인 노트북에 이르기까지 어디서나 실행됩니다. Gmail에서 YouTube, Google 검색에 이르기까지 Google의 모든 제품은 컨테이너에서 실행됩니다. 개발팀은 컨테이너화를 통해 더욱 신속하게 작업을 진행하고, 효율적으로 소프트웨어를 배포하며, 전례 없는 수준의 확장성을 확보할 수 있게 되었습니다. 그동안 컨테이너화된 워크로드를 실행하는 방법에 관해 많은 경험을 쌓으면서 Google은 커뮤니티에 계속 이 지식을 공유해 왔습니다. 초창기에 cgroup 기능을 Linux 커널에 제공한 것부터 내부 도구의 설계 소스를 Kubernetes 프로젝트로 공개한 것까지 공유의 사례는 다양합니다.</p> <h2 id="주요-특징"><a href="#주요-특징" class="header-anchor">#</a> 주요 특징</h2> <h3 id="일관성-있는-환경"><a href="#일관성-있는-환경" class="header-anchor">#</a> 일관성 있는 환경</h3> <p>개발자는 컨테이너를 이용해, 다른 애플리케이션과 분리된 예측 가능한 환경을 생성할 수 있습니다. 컨테이너는 애플리케이션에 필요한 소프트웨어 종속 항목(프로그래밍 언어 런타임 및 기타 소프트웨어 라이브러리의 특정 버전 등)도 포함할 수 있습니다. 개발자의 관점에서 이 모든 요소는 애플리케이션이 배포되는 최종 위치에 관계없이 항상 일관성이 있습니다. 그 결과 자연히 생산성이 향상될 수밖에 없습니다. 개발자와 IT 운영팀이 버그를 잡고 환경 차이를 진단하던 시간을 줄이고 사용자에게 신규 기능을 제공하는 데 집중할 수 있기 때문입니다. 또한 개발자가 개발 및 테스트 환경에서 세운 가정이 프로덕션 환경에서 그대로 실현될 것이기 때문에 버그 수 자체도 감소합니다.</p> <h3 id="폭넓은-구동-환경"><a href="#폭넓은-구동-환경" class="header-anchor">#</a> 폭넓은 구동 환경</h3> <p>컨테이너는 Linux, Windows, Mac 운영체제, 가상 머신, 베어메탈, 개발자의 컴퓨터, 데이터 센터, 온프레미스 환경, 퍼블릭 클라우드 등 사실상 어느 환경에서나 구동되므로 개발 및 배포가 크게 쉬워집니다. 컨테이너용 Docker 이미지 형식은 워낙 널리 사용되기 때문에 이동성도 매우 뛰어납니다. 소프트웨어 구동 환경이 무엇이든 컨테이너를 사용할 수 있습니다.</p> <h3 id="격리"><a href="#격리" class="header-anchor">#</a> 격리</h3> <p>컨테이너는 CPU, 메모리, 스토리지, 네트워크 리소스를 OS 수준에서 가상화하여 개발자에게 기타 애플리케이션으로부터 논리적으로 격리된 OS 샌드박스 환경을 제공합니다.</p> <table><thead><tr><th></th> <th style="text-align:center;">Container 장점</th> <th style="text-align:center;">VM 장점</th></tr></thead> <tbody><tr><td>일관성 있는 런타임 환경</td> <td style="text-align:center;">✓</td> <td style="text-align:center;">✓</td></tr> <tr><td>애플리케이션 샌드박스화</td> <td style="text-align:center;">✓</td> <td style="text-align:center;">✓</td></tr> <tr><td>디스크 용량 절감</td> <td style="text-align:center;">✓</td> <td style="text-align:center;"></td></tr> <tr><td>낮은 오버헤드</td> <td style="text-align:center;">✓</td> <td style="text-align:center;"></td></tr></tbody></table> <h2 id="주요-기술"><a href="#주요-기술" class="header-anchor">#</a> 주요 기술</h2> <h3 id="container-engine"><a href="#container-engine" class="header-anchor">#</a> Container Engine</h3> <ul><li>Docker : 다소 무거운 프로세스와 Root 로 실행된는 구조로 보안적 취약성 존재</li> <li>대체 엔진 : ContainerD, Cri-O, runC</li></ul> <h3 id="container-orchestration"><a href="#container-orchestration" class="header-anchor">#</a> Container Orchestration</h3> <p>Workload(Application)가 실행되는데 있 관어 필요한 NW, Storage, Resource등 필요한 기능을 가상화 기술을 통해서<br>
Isolation 모드로 지원하며,  Instance의 Life-Cycle을 관리 할 수 있도록 해주는 플랫폼.  그 외 개발/운영에 필요한 Tool과 API를 제공함</p> <ul><li>kubernetes</li> <li>openshift</li> <li>dc/os + marathon framework</li> <li>docker swarm</li></ul> <h2 id="container-build"><a href="#container-build" class="header-anchor">#</a> Container Build</h2> <h3 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> Dockerfile</h3> <blockquote><p>{..} 내용은 사용자 정의 항목</p></blockquote> <div class="language-Dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> <span class="token punctuation">{</span>Container Registry URI<span class="token punctuation">}</span>/<span class="token punctuation">{</span>Project Name<span class="token punctuation">}</span>/<span class="token punctuation">{</span>Repository Name<span class="token punctuation">}</span><span class="token punctuation">:</span><span class="token punctuation">{</span>Tag<span class="token punctuation">}</span>

<span class="token comment"># Container에 필요한 설치 설정 등을 위한 Shell Command 실행</span>
<span class="token comment"># 여러 명령어 블럭 실행 가능</span>
<span class="token keyword">RUN</span> <span class="token punctuation">{</span>Shell Command<span class="token punctuation">}</span>

<span class="token keyword">USER</span> <span class="token punctuation">{</span>user<span class="token punctuation">:</span><span class="token punctuation">[</span>group<span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token comment"># 작업되는 실행 경로 설정</span>
<span class="token comment"># 여러 명령어 블럭 실행 가능</span>
<span class="token keyword">WORKDIR</span> <span class="token punctuation">{</span>/the/workdir/path<span class="token punctuation">}</span>

<span class="token comment"># Container OS에 환경변수 설정</span>
<span class="token comment"># 여러 명령어 블럭 실행 가능</span>
<span class="token keyword">ENV</span> <span class="token punctuation">{</span>ENV<span class="token punctuation">-</span>KEY<span class="token punctuation">}</span> <span class="token punctuation">{</span>Value<span class="token punctuation">}</span>

<span class="token comment"># Container에 파일 복사</span>
<span class="token comment"># 여러 명령어 블럭 실행 가능</span>
<span class="token keyword">ADD</span> <span class="token punctuation">{</span>src<span class="token punctuation">}</span> <span class="token punctuation">{</span>destination<span class="token punctuation">}</span>

<span class="token comment"># Container에 파일 복사</span>
<span class="token comment"># 여러 명령어 블럭 실행 가능</span>
<span class="token keyword">COPY</span> <span class="token punctuation">{</span>src<span class="token punctuation">}</span> <span class="token punctuation">{</span>destination<span class="token punctuation">}</span>

<span class="token comment"># Container에 필요한 설치 설정 등을 위한 Shell Command 실행</span>
<span class="token comment"># 여러 명령어 블럭 실행 가능</span>
<span class="token keyword">RUN</span> <span class="token punctuation">{</span>Shell Command<span class="token punctuation">}</span>

<span class="token comment"># Continaer에서 사용되는 port를 외부로 노출시킨다.</span>
<span class="token comment"># ex) springboot port 8080</span>
<span class="token keyword">EXPOSE</span> 8080
<span class="token comment"># Container에서 추가적인 port를 오출시키는 경우 추가 지정</span>
<span class="token keyword">EXPOSE</span> 9090

<span class="token comment"># 선택사항으로 Container 시작을 위한 기본 실행 명령어</span>
<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">{</span>Shell Command<span class="token punctuation">}</span>

<span class="token comment"># 선택사항으로 Container 시작을 위한 ENTRYPOINT에 확장 명령어 처리</span>
<span class="token comment"># ENTRYPOINT 없는 경우 전체 실행 명령어 지정 가능</span>
<span class="token comment"># Docker run에 의해 override되는 영역으로 재정의 가능 함</span>
<span class="token keyword">CMD</span> <span class="token punctuation">{</span> Shell command extending to ENTRYPOINT <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><ol><li>FROM : 작성하고자 하는 Container의 기준/기본 OS설정<br>
. Container Registry URI : Container 저장소 서비스 주소<br>
. Project : Container 그룹을 의미하며, 주로 사용자 권한을 Project 단위로 관리함<br>
. Repository : Container 저장공간<br>
. Tag: 동일한 Container 저장공간에 세부적인 버전을 구분하기 위한 정보<br>
. AS [name] 으로 Dockerfile 의 Container를 이름으로 지정하여 COPY --from으로 복사시 Source 위치를 지정할 수 있음</li> <li>RUN : Container 빌드에 필요한 Shell Command 처리</li> <li>USER : ENTRYPOINT, CMD 실행시 적용할 사용자 지정. RUN으로 사용자 추가필요</li> <li>WORKDIR : RUN 및 ENTRYPOINT, CMD 실행 경로 지정</li> <li>COPY : source에서 destination으로 복사. --from을 사용하여 이름으로 지정된 다른 Container를 Source로 지정할 수 있음.</li> <li>Add : COPY와 동일한 기능을 수행하며, <strong>source를 URL</strong>로 지정할 수 있으며, tar파일인 경우 자동으로 압축 해재하여 복사한다.</li> <li>ENTRYPOINT : 선택사항으로 Container가 실행될 때 최초 실행 될 때 사용되는 명령어</li> <li>CMD :  선택사항으로 Container가 실행될 때 최초 실행 될 Command line을 확장하는 방법임<br>
ENTRYPOINT가 있는 경우 추가적인 argument가 전달되며, ENTRYPOINT가 없는 경우 직접 실행 명령어를 지정해도됨</li></ol> <h3 id="container-빌드-구성"><a href="#container-빌드-구성" class="header-anchor">#</a> Container 빌드 구성</h3> <ol><li><p>단순 Container 개발 : 이미 빌드된 App와 Middleware 등의 설치를 위한 방법</p> <div class="language-Dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment">#Springboot jar 예제</span>
<span class="token keyword">FROM</span> openjdk<span class="token punctuation">:</span>11
<span class="token comment"># 작업 경로 생성</span>
<span class="token keyword">RUN</span> mkdir /app
<span class="token comment"># 작업/현재 경로 설정 cd와 같은 기능</span>
<span class="token keyword">WORKDIR</span> /app

<span class="token keyword">ARG</span> JAR_FILE=target/*.jar
<span class="token keyword">EXPOSE</span> 8080
<span class="token keyword">COPY</span> $<span class="token punctuation">{</span>JAR_FILE<span class="token punctuation">}</span> /app/app.jar
<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-jar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/app/app.jar&quot;</span><span class="token punctuation">]</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>Stage Build를 이용한 개발: GitAction, GitLab CI, Circle CI 등에 사용되며, 빌드 환경이   다양한 경우 Build 용 Container와 Runtime Container를 분리하여 처리 함으로써, 불필요한 내용을  RunTime Container에서 제외하여 크기 축소 및 실행(Bootstrap)을 빠르게 처리함</p> <div class="language-Dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># build에 사용할 기준 Container 선언. </span>
<span class="token comment"># as [Name]으로 빌드 컨테이너를 저장소로 사용하기 위한 이름 지정</span>
<span class="token keyword">FROM</span> maven<span class="token punctuation">:</span>3.8.1<span class="token punctuation">-</span>jdk<span class="token punctuation">-</span>11 AS build

<span class="token comment"># 필요한 파일을 local에서 container로 복사</span>
<span class="token keyword">COPY</span> src /usr/src/app/src
<span class="token keyword">COPY</span> pom.xml /usr/src/app
<span class="token comment"># RUN mvn -f /usr/src/app/pom.xml clean dependency:go-offline -B</span>
<span class="token comment"># maven build를 실행</span>
<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=~/.m2 mvn <span class="token punctuation">-</span>f /usr/src/app/pom.xml clean package <span class="token punctuation">-</span>DskipTests

<span class="token comment"># Target 컨테이너의 기준 container 선언</span>
<span class="token keyword">FROM</span> openjdk<span class="token punctuation">:</span>11

<span class="token comment"># 작업 경로 생성</span>
<span class="token keyword">RUN</span> mkdir /app
<span class="token comment"># 작업/현재 경로 설정 cd와 같은 기능</span>
<span class="token keyword">WORKDIR</span> /app

<span class="token comment"># 필요한 파일을 build 컨테이너에서 target으로 복사</span>
<span class="token comment"># 'build'는 위에서 선언한 컨테이너 이름</span>
<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=build /usr/src/app/target/*.jar /app/app.jar
<span class="token comment"># 외부로 노툴할 port </span>
<span class="token keyword">EXPOSE</span> 8080
<span class="token comment">#실행 명령어</span>
<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-jar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/app/app.jar&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li></ol> <h3 id="docker-command"><a href="#docker-command" class="header-anchor">#</a> Docker Command</h3> <ol><li><p>build</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>docker build -t <span class="token punctuation">[</span>repository uri<span class="token punctuation">]</span>/<span class="token punctuation">[</span>project name<span class="token punctuation">]</span>/<span class="token punctuation">[</span>container name<span class="token punctuation">]</span>:<span class="token punctuation">[</span>tag<span class="token punctuation">]</span> <span class="token builtin class-name">.</span>
docker build <span class="token builtin class-name">.</span>
<span class="token comment"># tag 없이 빌드된 경우 docker images로 [image id]를 확인히여 tagging할 수 있음</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>tag : Container 별칭으로서, 버전을 구분하기위해 주로 사용.</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>docker tag <span class="token punctuation">[</span>image id<span class="token punctuation">]</span> <span class="token punctuation">[</span>repository uri<span class="token punctuation">]</span>/<span class="token punctuation">[</span>project name<span class="token punctuation">]</span>/<span class="token punctuation">[</span>container name<span class="token punctuation">]</span>:<span class="token punctuation">[</span>tag<span class="token punctuation">]</span>
docker tag <span class="token punctuation">[</span>repository uri<span class="token punctuation">]</span>/<span class="token punctuation">[</span>project name<span class="token punctuation">]</span>/<span class="token punctuation">[</span>container name<span class="token punctuation">]</span>:<span class="token punctuation">[</span>old tag<span class="token punctuation">]</span> <span class="token punctuation">[</span>repository uri<span class="token punctuation">]</span>/<span class="token punctuation">[</span>project name<span class="token punctuation">]</span>/<span class="token punctuation">[</span>container name<span class="token punctuation">]</span>:<span class="token punctuation">[</span>new tag<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>push : 해당 Container를 서버 저장소(Registry)에 저장(login 필요)<br>
서버 주소와 tag의 repository uri가 동일해야 함</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>docker push <span class="token punctuation">[</span>repository uri<span class="token punctuation">]</span>/<span class="token punctuation">[</span>project name<span class="token punctuation">]</span>/<span class="token punctuation">[</span>container name<span class="token punctuation">]</span>:<span class="token punctuation">[</span>tag<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>run : <a href="https://docs.docker.com/engine/reference/run/" target="_blank" rel="noopener noreferrer">Container를 실행<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>docker run <span class="token punctuation">\</span>
   <span class="token comment"># Detached after run \</span>
   -d <span class="token punctuation">\</span> 
   --name <span class="token punctuation">[</span>container instance name<span class="token punctuation">]</span> <span class="token punctuation">\</span>
   <span class="token comment"># volume mount \</span>
   -v <span class="token punctuation">[</span>local volume<span class="token punctuation">]</span>:<span class="token punctuation">[</span>container path to mount<span class="token punctuation">]</span> <span class="token punctuation">\</span>
   <span class="token comment"># container 환경변수 선언 \</span>
   -e <span class="token string">&quot;key=value&quot;</span> <span class="token punctuation">\</span>
   <span class="token comment"># port mapping/forward \</span>
   -p <span class="token punctuation">[</span>local port<span class="token punctuation">]</span>:<span class="token punctuation">[</span>container port<span class="token punctuation">]</span> <span class="token punctuation">\</span>
   <span class="token comment"># 실행할 Container Image URI \</span>
   IMAGE<span class="token punctuation">[</span>:TAG<span class="token operator">|</span>@DIGEST<span class="token punctuation">]</span> <span class="token punctuation">\</span>
   <span class="token comment"># 지정할 경우 Dockerfile의 CMD 블럭 대채(선택 사항) \</span>
   <span class="token punctuation">[</span>command <span class="token keyword">for</span> CMD<span class="token punctuation">(</span>optional<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>logs : container stdout 확인</p> <ul><li>--follow, -f: 연속해서 로그 보기</li> <li>--tail, -n : 마지막 로그 줄 숫자</li></ul></li></ol> <div class="custom-block tip"><p class="custom-block-title">참조</p> <ul><li><a href="https://cloud.google.com/containers/?hl=ko" target="_blank" rel="noopener noreferrer">https://cloud.google.com/containers/?hl=ko<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cloud.google.com/learn/what-are-containers?hl=ko" target="_blank" rel="noopener noreferrer">https://cloud.google.com/learn/what-are-containers?hl=ko<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.samsungsds.com/kr/insights/docker.html" target="_blank" rel="noopener noreferrer">https://www.samsungsds.com/kr/insights/docker.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/am-arch/cloud-native-app/" class="prev router-link-active">
        Introduction
      </a></span> <span class="next"><a href="/am-arch/cloud-native-app/k8s.html">
        Kubernetes
      </a>
      →
    </span></p></div> </main></div></div><div class="global-ui"></div></div>
    <script src="/am-arch/assets/js/app.89e1056e.js" defer></script><script src="/am-arch/assets/js/2.158b03bb.js" defer></script><script src="/am-arch/assets/js/22.b2655bc9.js" defer></script><script src="/am-arch/assets/js/30.495713a6.js" defer></script>
  </body>
</html>
